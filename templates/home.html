{% extends "base.html" %}

{% block title %}Cake Siphosh - Fresh Daily Baked Goods{% endblock %}

{% block content %}
<div class="container">
    <!-- Top Navigation -->
    <div class="d-flex justify-content-end mb-5">
            {% if not session.user %}
        <div class="d-flex gap-2">
            <a href="{{ url_for('login') }}?tab=register" class="btn btn-outline-primary">
                <i class="bi bi-person-plus me-2"></i>Register
            </a>
            <a href="{{ url_for('login') }}" class="btn btn-primary">
                <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
            </a>
            </div>
            {% else %}
        <a href="{{ url_for('customer_dashboard' if session.user.role != 'admin' else 'admin_dashboard') }}" 
           class="btn btn-primary">Dashboard</a>
                {% endif %}
    </div>

    <!-- Products Section -->
    <div class="mb-5" id="products">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">Featured Products</h2>
            <div class="filter-buttons d-flex gap-2">
                <button class="btn btn-filter active" onclick="filterProducts('all')">All</button>
                <button class="btn btn-filter" onclick="filterProducts('cakes')">Cakes</button>
                <button class="btn btn-filter" onclick="filterProducts('pastries')">Pastries</button>
                <button class="btn btn-filter" onclick="filterProducts('breads')">Breads</button>
            </div>
        </div>
        
        <div class="row g-4">
            {% for product in products %}
            <div class="col-md-4 product-card" data-category="{{ product.category|default('all') }}">
                <div class="card h-100 border-0 shadow-hover">
                    {% if product.image_url %}
                    <div class="product-image-wrapper">
                        <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.name }}">
                        {% if not session.user %}
                        <button class="btn btn-gradient quick-add-btn" onclick="redirectToLogin(event)">
                            <i class="bi bi-cart-plus"></i> Login to Order
                        </button>
                        {% else %}
                        <button class="btn btn-gradient quick-add-btn" onclick="addToCart('{{ product.id }}', event)">
                            <i class="bi bi-cart-plus"></i> Add to Cart
                        </button>
                        {% endif %}
    </div>
                    {% endif %}
                <div class="card-body">
                        <div class="category-badge">{{ product.category|default('Bakery')|title }}</div>
                        <h5 class="card-title">{{ product.name }}</h5>
                        <p class="card-text text-muted">{{ product.description }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="price">R{{ "%.2f"|format(product.price) }}</span>
                            <div class="product-rating">
                                <i class="bi bi-star-fill"></i>
                                <span class="ms-1">{{ product.rating|default('4.5') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Features Section -->
    <div class="features-section py-5">
        <div class="container">
            <h2 class="text-center mb-5">Why Choose Us</h2>
            <div class="row g-4">
                <div class="col-md-3">
                    <div class="feature-card">
                        <i class="bi bi-clock-history"></i>
                        <h4>Fresh Daily</h4>
                        <p>Baked fresh every morning for the best quality and taste</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card">
                        <i class="bi bi-truck"></i>
                        <h4>Fast Delivery</h4>
                        <p>Quick and reliable delivery to your doorstep</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card">
                        <i class="bi bi-heart"></i>
                        <h4>Quality Ingredients</h4>
                        <p>Only the finest ingredients for the best results</p>
            </div>
        </div>
                <div class="col-md-3">
                    <div class="feature-card">
                        <i class="bi bi-gift"></i>
                        <h4>Custom Orders</h4>
                        <p>Personalized cakes and treats for special occasions</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3"></div>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
/* Colorful Theme */
:root {
    --primary-gradient: linear-gradient(45deg, #FF6B6B, #FF8E53);
    --secondary-gradient: linear-gradient(45deg, #4E65FF, #92EFFD);
    --accent-gradient: linear-gradient(45deg, #6B4EFF, #B892FD);
}

/* Filter Buttons */
.btn-filter {
    padding: 8px 20px;
    border-radius: 25px;
    background: white;
    color: #666;
    border: 2px solid #eee;
    transition: all 0.3s ease;
}

.btn-filter:hover, .btn-filter.active {
    background: var(--primary-gradient);
    color: white;
    border-color: transparent;
    transform: translateY(-2px);
}

/* Product Cards */
.shadow-hover {
    transition: all 0.3s ease;
}

.shadow-hover:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
}

.product-image-wrapper {
    position: relative;
    overflow: hidden;
    border-radius: 10px 10px 0 0;
}

.product-image-wrapper img {
    transition: transform 0.3s ease;
}

.product-card:hover .product-image-wrapper img {
    transform: scale(1.05);
}

.quick-add-btn {
    position: absolute;
    bottom: -50px;
    left: 50%;
    transform: translateX(-50%);
    transition: all 0.3s ease;
    background: var(--primary-gradient);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
}

.product-card:hover .quick-add-btn {
    bottom: 20px;
}

.category-badge {
    display: inline-block;
    padding: 4px 12px;
    background: var(--secondary-gradient);
    color: white;
    border-radius: 15px;
    font-size: 0.8rem;
    margin-bottom: 10px;
}

.price {
    font-size: 1.25rem;
    font-weight: bold;
    background: var(--accent-gradient);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.product-rating {
    color: #FFD700;
}

/* Feature Cards */
.feature-card {
    text-align: center;
    padding: 30px;
    border-radius: 15px;
    background: white;
    transition: all 0.3s ease;
}

.feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.feature-card i {
    font-size: 2.5rem;
    margin-bottom: 20px;
    background: var(--primary-gradient);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.features-section {
    background: #f8f9fa;
}

/* Toast Styling */
.toast-container {
    z-index: 1050;
}

.btn-gradient {
    background: var(--primary-gradient);
    border: none;
    color: white;
}

.btn-gradient:hover {
    opacity: 0.9;
    color: white;
}
</style>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
function redirectToLogin(event) {
    event.preventDefault();
    window.location.href = "{{ url_for('login') }}";
}

function filterProducts(category) {
    const products = document.querySelectorAll('.product-card');
    products.forEach(product => {
        if (category === 'all' || product.dataset.category === category) {
            product.style.display = 'block';
        } else {
            product.style.display = 'none';
        }
    });
}

function showToast(title, message, type = 'info') {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type === 'error' ? 'danger' : 'success'} border-0`;
    toast.setAttribute('role', 'alert');
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                <strong>${title}:</strong> ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;
    
    toastContainer.appendChild(toast);
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    toast.addEventListener('hidden.bs.toast', () => {
        toast.remove();
    });
}

function addToCart(productId, event) {
    event.preventDefault();
    const button = event.target.closest('button');
    button.disabled = true;
    const originalContent = button.innerHTML;
    button.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Adding...';

    fetch(`/cart/add/${productId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('Success', 'Item added to cart', 'success');
        } else {
            showToast('Error', data.error || 'Error adding to cart', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Error', 'Error adding to cart', 'error');
    })
    .finally(() => {
        button.disabled = false;
        button.innerHTML = originalContent;
    });
}
</script>
{% endblock %} 